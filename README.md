# One File - 智能 UA 订阅分发系统

> **基于 Cloudflare Workers 的高性能配置分发代理。** 根据客户端 User-Agent (UA) 自动匹配并下发 GitHub Gist 上的订阅配置文件，完美适合各类代理客户端。

---

## ✨ 核心特性

* **⚡ 边缘响应**：利用 Cloudflare 全球边缘网络，实现配置文件的秒级转发与分发。
* **🧠 智能分发逻辑**：
    * **UA 关键词匹配**：支持为不同客户端（如 Clash, Mihomo, Surge, Stash 等）设置专用关键词。
    * **优先级排序**：支持拖拽调整规则顺序，系统将按照从上到下的顺序进行首次命中匹配。
* **🎨 现代管理后台**：
    * **视觉风格**：采用玻璃拟态（Glassmorphism）设计，支持深色/浅色/系统跟随模式。
    * **全功能面板**：无需修改代码，直接在网页端增删改查规则。
* **🛠 实用工具链**：
    * **UA 命中测试**：后台内置模拟测试器，实时验证特定 UA 是否能正确命中预期规则。
    * **连通性检测**：一键检测目标 Gist 地址的连通性状态。
    * **实时预览**：内置预览弹窗，无需跳转即可直接查看或复制代码内容。
* **🔐 安全保障**：
    * **AES-GCM 加密备份**：导出配置时支持自定义密码加密，确保你的订阅地址不会泄露。
* **📊 数据分析**：记录每个配置的**总访问次数**和**最后访问时间**。

---

## 🚀 快速开始

### Cloudflare Pages 部署

### 准备工作
* 拥有一个 [Cloudflare](https://dash.cloudflare.com/) 账号。
* 创建一个 **KV 命名空间**，命名为 `CONFIG_KV`。

#### Git仓库部署
1. 进入[Cloudflare Pages](https://dash.cloudflare.com/?to=/:account/pages)
2. 导入Git仓库
3. 保存并部署

#### 手动上传
1. 下载[_worker.js](./dist/_worker.js)并压缩为ZIP
2. 在Pages控制台选择直接上传
3. 选择ZIP文件部署
4. 绑定自定义域名

### 重要步骤‼️

在项目页 **Settings -> Functions** 中绑定刚才创建的 **KV**：
   * **Variable name**: `CONFIG_KV`
   * **KV namespace**: 选择你创建的命名空间 (如 `CONFIG_KV` )

## ⚙️ 环境变量
| 参数名          | 说明               | 示例值                            |
|----------------|--------------------|----------------------------------|
|`ADMIN_PASSWORD`| 设置你的后台登录密码（默认为 `admin888`）。| `YOURPASSWOED` |
|`BACKGROUND_URL`| 自定义后台背景图片链接。                 | `图片URL`      |
|`GITHUB_TOKEN`  | 修改gist仓库内配置文件。                 | `ghp_******`      |

### 使配置生效
⚠️ 注意：绑定 KV 或修改环境变量后，**必须重新部署**：
   * 进入项目的 Deployments 页面。
   * 找到最新的部署记录，点击右侧的三个点 ...。
   * 选择 `Retry deployment`。
---

## 🛠 功能使用详解

### 1. 规则匹配逻辑
* **关键词设定**：在“UA关键词”栏输入，多个词用英文逗号分隔（如 `clash,mihomo`）。
* **文件命名**：在“备注/文件名”中设置的名字，将作为客户端下载后的默认文件名（会自动补全 `.yaml`）。
* **手动指定文件名**：访问时附带参数 `?name=MyFile` 可覆盖默认设置。

### 2. UA 命中测试
在后台顶部的“UA 命中测试”框中粘贴客户端的 User-Agent 字符串，点击测试即可即时看到该设备会触发哪一条规则。

### 3. 配置备份与恢复
* **备份与恢复**：点击导航栏右上角“数据库”图标，选择使用备份或者恢复功能。输入解密密码，下载加密后的 `.bin` 备份文件。
* **注意**：导入后需点击页面底部的“保存配置”才会正式生效到 KV。

### 4. 统计管理
访问统计会实时更新。如果需要重新统计，点击表头“访问统计”旁边的**红色删除图标**即可清空历史数据。

### 5. 文件预览
点击规则右侧的“眼睛”图标 👁️，系统会代理抓取 Gist 内容并在弹窗中展示，支持编辑/一键复制代码。

### 6. 更多功能自行探索。

---

 ***花有重开日，人无再少年。***

---
